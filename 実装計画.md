J-SOX RCM情報抽出AIエージェント 実装計画
前提条件
技術スタック（案）:
バックエンド: Python, Pandas, Langchain
フロントエンド: Streamlit
AI/LLM: OpenAI API GPT-5
フェーズ1: コア機能開発 (MVP)
目的: まずは単一のファイルをアップロードし、AIと対話しながら手動でルールを確定させ、CSVをダウンロードできる基本バージョンを完成させます。 
☑ バックエンド (データ処理層)
[x] ファイル入出力
[x] Excelファイル (.xlsx, .xls) のアップロードを受け付けるUIを作成する。
[x] CSVファイル (.csv) のアップロードを受け付けるUIを作成する。
[x] アップロードされたファイルをPandas DataFrameとして読み込む処理を実装する。
[x] 処理結果をCSV形式でダウンロードさせるAPIエンドポイントを作成する。
[x] LLM連携
[x] LLM API (OpenAI) と通信するための基本モジュールを実装する。
[x] APIキーなどを安全に管理する仕組みを導入する (環境変数など)。
[x] データ処理ロジック (初回解析)
[x] 構造理解: DataFrameのヘッダー候補とデータサンプルをLLMに渡し、カラムの役割を推論させるプロンプトを設計・実装する。
[x] 整形・抽出ルールの生成: LLMの推論結果を、JSON形式などの標準化されたルール（例: {"action": "combine", "columns": ["B", "C"], "new_column": "リスク"}）に変換する処理を実装する。
[x] ルール適用: 生成されたルール案に基づき、DataFrameを加工・整形する関数を実装する。
☑ フロントエンド (UI層)
[x] 基本画面
[x] ファイルをアップロードするためのUI (ドラッグ＆ドロップ対応が望ましい) を作成する。
[x] 処理中であることがわかるローディングインジケーターを実装する。
[x] 対話・修正インターフェース
[x] AIが生成した抽出ルール案を分かりやすく表示するコンポーネントを作成する。
[x] ユーザーが各カラムの役割（リスク、コントロール等）をプルダウンメニューで修正できる機能を実装する。
[x] 複数のカラムを結合する、といった基本的な整形ルールをユーザーが指示できるUIを実装する。
[x] 修正したルールを適用した結果がプレビューできるテーブル表示機能を実装する。
[x] 操作
[x] 最終的なルールをバックエンドに送信する「承認」ボタンを実装する。
[x] 処理結果をダウンロードするための「CSVダウンロード」ボタンを実装する。
フェーズ2: パターン学習機能の開発
目的: MVPに「参照型パターン」の仕組みを導入します。過去の処理内容を記憶し、AIの推論を補助することで、2回目以降の処理を高速化・高精度化します。 期間目安: 3〜4週間
[x] バックエンド (学習・推論層)
[x] パターンデータベース(DB)
[x] 承認済みパターンを保存するためのデータベースを設計・構築する (json,yaml)。
[x] テーブルスキーマを定義する (パターンID, パターン名, ファイル特徴, 抽出ルールJSONなど)。
[x] パターン保存・更新
[x] ユーザーによる「承認」時、確定した抽出ルールと、そのRCMの特徴（カラム名リストなど）をDBに保存/更新するAPIを実装する。
[x] 類似パターン検索
[x] 新規ファイル入力時、その特徴をLLMに要約させる処理を実装する。
[x] 要約された特徴を基に、DBから意味的に最も類似するパターンを検索するロジックを実装する (LLMを活用した検索)。
[x] 推論補助ロジック
[x] 検索でヒットした類似パターンを「ヒント」としてLLMのプロンプトに組み込む処理を実装する。
[x] フロントエンド (UI層)
[x] フィードバック表示
[x] 類似パターンが見つかった場合に、「過去の "XXX" パターンを参考に提案を作成しました」といった通知を表示する機能を実装する。
[ ] パターン管理（オプション）
[ ] 保存されているパターンの一覧を表示する管理画面を作成する。
[ ] パターンに分かりやすい名前（例: "A監査法人向けフォーマット"）を付けたり、不要なパターンを削除したりする機能を実装する。
フェーズ3: UI/UXの高度化と運用機能
目的: 実務での利用を想定し、より使いやすく、安定して動作するための周辺機能を充実させます。 期間目安: 2〜3週間
☐ フロントエンド & バックエンド
[ ] 一括処理機能
[ ] 複数のファイルを一度にアップロードできるUIを実装する。
[ ] アップロードされたファイルをバックエンドで一つずつ、または並行して処理するキューイングシステムを実装する。
[ ] 全ファイルの処理結果を一覧で表示し、個別にまたはまとめてダウンロードできる機能を実装する。
[ ] 安定性と運用
[ ] エラーハンドリング: LLMからの応答エラー、処理できないファイル形式、タイムアウトなど、予期せぬエラーを適切に処理し、ユーザーに分かりやすく通知する仕組みを強化する。
[ ] ログ機能: どのユーザーが、いつ、どのファイルを、どのパターンで処理したか、といった操作ログを記録する機能を実装する。
[ ] UI改善
[ ] 処理履歴を閲覧できる画面を追加する。
[ ] ユーザーからのフィードバックに基づき、ボタンの配置や文言などを改善する。
